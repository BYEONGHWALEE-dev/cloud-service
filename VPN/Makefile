# Makefile

CC = gcc
CFLAGS = -Wall -Wextra -std=c99 -D_DEFAULT_SOURCE -I include
LDFLAGS =

# ë””ë ‰í† ë¦¬
SRC_DIR = src
BUILD_DIR = bin
INCLUDE_DIR = include

# íƒ€ê²Ÿ
.PHONY: all clean test help

all: $(BUILD_DIR)/tun_test $(BUILD_DIR)/vpn_server $(BUILD_DIR)/udp_test_client

# TUN í…ŒìŠ¤íŠ¸ í”„ë¡œê·¸ë¨ (ê¸°ì¡´)
$(BUILD_DIR)/tun_test: $(SRC_DIR)/server/tun_test.c $(SRC_DIR)/server/tun_manager.c
	@mkdir -p $(BUILD_DIR)
	$(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)
	@echo "âœ… Build complete: $@"

# VPN ì„œë²„ (ë©”ì¸)
$(BUILD_DIR)/vpn_server: $(SRC_DIR)/server/vpn_server.c \
                          $(SRC_DIR)/server/tun_manager.c \
                          $(SRC_DIR)/server/udp_server.c \
                          $(SRC_DIR)/server/client_manager.c \
                          $(SRC_DIR)/common/protocol.c
	@mkdir -p $(BUILD_DIR)
	$(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)
	@echo "âœ… Build complete: $@"

# UDP í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸
$(BUILD_DIR)/udp_test_client: $(SRC_DIR)/client/udp_test_client.c \
                               $(SRC_DIR)/common/protocol.c
	@mkdir -p $(BUILD_DIR)
	$(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)
	@echo "âœ… Build complete: $@"

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
test:
	@echo "VPN Server Test Commands:"
	@echo "  sudo ./bin/vpn_server          # VPN ì„œë²„ ì‹¤í–‰"
	@echo "  ./bin/udp_test_client 127.0.0.1  # í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸"
	@echo "  sudo ./bin/tun_test              # TUN í…ŒìŠ¤íŠ¸ë§Œ"

# ì •ë¦¬
clean:
	rm -rf $(BUILD_DIR)/*
	@echo "ğŸ§¹ Clean complete"

# ë„ì›€ë§
help:
	@echo "VPN Server Build System"
	@echo ""
	@echo "Targets:"
	@echo "  all            - Build all targets"
	@echo "  tun_test       - Build TUN test only"
	@echo "  vpn_server     - Build VPN server"
	@echo "  udp_test_client - Build test client"
	@echo "  test           - Show test commands"
	@echo "  clean          - Remove built files"
	@echo "  help           - Show this help"
